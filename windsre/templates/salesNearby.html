<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">

  <xi:include href="master.html" />

<head>
  <title>Enter the address to get Nearby sales</title>
</head>

<body>
	<div class="row">
    <div class="col-xs-12 well">
      <h2 align="center">Get Sales for the given address</h2>
      
      <p py:if="not kw">In this page you can enter the addresses you wish to get nearby sales for. </p>
      <p py:if="not kw"> To enter multiple addresses use separator "|".</p>
      <p py:if="not kw"> If you wish to enter the metadata for the subject property please use the separator ":"</p>
      <p py:if="not kw"> Like address:beds:baths:sqft:lot size:price</p>
      <p py:if="not kw"> Please keep the sequence of metadata same for better results</p>				
      <p class="form-control" py:if="not kw">${form.display(value="Find Sales")}</p>

      <span py:if="kw">
        <p align="center">Here is the analysis of current property you are looking at </p>
        
        <table border="1" style="width:30%" class="table-striped container">
	        <tr py:for="address in kw['result']">
	        	<td>${address}</td><td><a href="#${address}">View</a></td>
	      	</tr>
      	</table>
      </span>
      
      &nbsp;&nbsp;
      <span py:if="kw" >
      	<ul>
      		<li py:for="address in kw['result']">
      			<br></br>
      			<a name="${address}"></a>
	      		<span py:if="kw" class="header">Here are nearby sales for the following address <b>${address}</b> <br></br><font size="2" color="blue">${kw['result'][address]['metadata']}</font></span>
	      		<br></br>
	      		
 	      		<table border="1" style="width:300%" class="table-striped">

	      			<?python
	      			import re
	      	
      				avgprice = 0.0
      				sumbr = 0.0
			      	btotal = 0
			      	ptotal = 0
			      	avgpps = 0.0
			      	avgbr = 0.0
			      	for each in kw['result'][address]:
			      		for value in kw['result'][address][each].split('|'):
			      			if "price per Sqft" in value :
			      				pps = re.sub('[A-Za-z]','',value)
			      				if pps:
			      					avgprice += float(pps)
			      					ptotal += 1
			      				
			      			if "Build Ratio" in value :
			      				br = re.sub('[A-Za-z]','',value)
			      				if br:
			      					sumbr = sumbr + float(br)
			      					btotal += 1
			      					
			      	if (ptotal == 0):
			      		ptotal = 1
			      	if (btotal == 0):
			      		btotal = 1
			      					
				    ?>
				    <?python
				    avgpps = float(avgprice)/float(ptotal)
				    avgbr = float(sumbr)/float(btotal)
				    ?>
				    <tr></tr>
					<tr class="table-header">
						<th> Address </th>
		      			<th> Beds </th>
		      			<th> Baths </th>
		      			<th> Lot Size </th>
		      			<th> Square feet </th>
		      			<th> Price </th>
		      			<th> Build Ratio </th>
		      			<th> Price/SqFt </th>	
		      			<th></th>
		      			<th> Comp Price/SqFt </th>	
		      			<th> Comp Buid Ratio </th>		
		      		</tr>    
				    
	      			<tr class="table-row" py:for="each in kw['result'][address]">
						<td py:if="each != 'metadata'"> $each </td>
						<?python
						import re
				      	dataArray = []
				      	cmppps=""
				      	cmpbr=""
				      	
				      	for value in kw['result'][address][each].split('|'):
				      		if "price per Sqft" in value :
				      			pps=re.sub('[A-Za-z]','',value)
				      			cmppps = float(pps) - float(avgpps)
				      		if "Build Ratio" in value :
				      			br = re.sub('[A-Za-z]','',value)
				      			if br:
				      				cmpbr = float(br) - float(avgbr)
				      			else:
				      				cmpbr = ""
				      		
				      		dataArray.append(re.sub('[A-Za-z]','',value))
				      	?>
	      			   <td py:for="data in dataArray" py:if="each != 'metadata'">${data}</td>
	      			   <td><font size="2" color="blue"> ${cmppps} </font></td>
	      			   <td><font size="2" color="blue"> ${cmpbr} </font></td>
	      			</tr>
	      		</table>
	      		<br></br>
	      		<span class="footer">Comp Average Price Per Sqft is <font size="3" color="blue"><b>${avgpps}</b></font> and Comp Average Build ratio is <font size="3" color="blue"><b>${avgbr}</b></font></span>
	      		
	      	</li>
     	 </ul>
	  </span>
 	</div>
  </div>
</body>
</html>
